<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>동적 리밸런싱을 결합한 200일 이동평균 돌파 전략 시각화</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f0f4f8;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .flow-box {
            border: 2px solid #369EFF;
            background-color: white;
            padding: 1rem;
            border-radius: 0.5rem;
            text-align: center;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: transform 0.2s;
        }
        .flow-box:hover {
            transform: translateY(-5px);
        }
        .flow-decision {
            border: 2px solid #0065D2;
            background-color: #EBF5FF;
        }
        .flow-action {
            border: 2px solid #004AAD;
            background-color: #FFFFFF;
        }
        .flow-arrow {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            color: #0065D2;
            margin: 0.5rem 0;
        }
        .flow-line {
            width: 2px;
            background-color: #0065D2;
            margin: 0 auto;
        }
        .kpi-card {
            background-color: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            text-align: center;
        }
        .kpi-title {
            font-size: 1.125rem;
            color: #004AAD;
            font-weight: bold;
        }
        .kpi-value {
            font-size: 2.25rem;
            color: #0065D2;
            font-weight: bold;
            margin-top: 0.5rem;
        }
    </style>
</head>
<body class="bg-slate-50 text-gray-800">

    <div class="container mx-auto p-4 md:p-8">
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-bold text-[#004AAD] mb-2">200일 이동평균 돌파 전략 분석</h1>
            <p class="text-lg text-gray-600">동적 리밸런싱을 결합한 알고리즘 트레이딩 로직 시각화</p>
        </header>

        <section id="introduction" class="mb-16">
            <h2 class="text-3xl font-bold text-center text-[#004AAD] mb-8">전략의 핵심 구성 요소</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="kpi-card">
                    <div class="kpi-title">📈 신호 생성기 (The Signal)</div>
                    <div class="kpi-value">QQQ ETF</div>
                    <p class="mt-2 text-gray-600">QQQ의 가격과 200일 이동평균선을 비교하여 시장의 장기 추세를 판단하고, '매수' 또는 '매도' 신호를 생성합니다. 이 자산에 직접 투자하지는 않습니다.</p>
                </div>
                <div class="kpi-card">
                    <div class="kpi-title">🚀 투자 수단 (The Vehicle)</div>
                    <div class="kpi-value">TQQQ ETF</div>
                    <p class="mt-2 text-gray-600">상승 추세 판단 시, 수익 극대화를 위해 3배 레버리지 ETF인 TQQQ에 투자합니다. 이는 전략의 고위험-고수익 특성을 결정합니다.</p>
                </div>
            </div>
        </section>

        <section id="flowchart" class="mb-16">
            <h2 class="text-3xl font-bold text-center text-[#004AAD] mb-8">일일 의사결정 순서도</h2>
            <p class="text-center text-gray-600 max-w-3xl mx-auto mb-10">
                알고리즘은 매일 아래의 순서도를 따라 포트폴리오 상태를 점검하고, 시장 진입, 이탈, 또는 포지션 유지 및 리밸런싱을 결정합니다. 모든 결정은 QQQ 가격과 200일 이동평균선의 관계에서 시작됩니다.
            </p>
            <div class="max-w-4xl mx-auto">
                <div class="flow-box flow-decision">
                    <span class="font-bold">1. 포트폴리오가 현재 시장에 진입한 상태인가? (`in_market`)</span>
                </div>
                <div class="grid grid-cols-2 gap-4 mt-4">
                    <div class="text-center font-bold text-red-600">아니오 (위험 회피 상태)</div>
                    <div class="text-center font-bold text-green-600">예 (위험 선호 상태)</div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="flow-arrow">↓</div>
                    <div class="flow-arrow">↓</div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="flow-box flow-decision">
                        <span class="font-bold">2a. QQQ 가격 > 200일 이동평균선인가?</span>
                        <p class="text-sm text-gray-500">(상승 추세 전환 신호)</p>
                    </div>
                    <div class="flow-box flow-decision">
                        <span class="font-bold">2b. QQQ 가격 < 200일 이동평균선인가?</span>
                        <p class="text-sm text-gray-500">(하락 추세 전환 신호)</p>
                    </div>
                </div>
                
                <div class="grid grid-cols-4 gap-2 mt-4">
                    <div class="text-center font-bold text-gray-500">아니오</div>
                    <div class="text-center font-bold text-green-600">예</div>
                    <div class="text-center font-bold text-gray-500">아니오</div>
                    <div class="text-center font-bold text-red-600">예</div>
                </div>

                <div class="grid grid-cols-4 gap-2">
                    <div><div class="flow-arrow">↓</div></div>
                    <div><div class="flow-arrow">↓</div></div>
                    <div><div class="flow-arrow">↓</div></div>
                    <div><div class="flow-arrow">↓</div></div>
                </div>

                <div class="grid grid-cols-4 gap-2">
                    <div class="flow-box flow-action h-full">
                        <span class="font-bold">현금 보유</span>
                        <p class="text-sm text-gray-500">아무것도 하지 않음</p>
                    </div>
                    <div class="flow-box flow-action h-full bg-green-50 border-green-500">
                        <span class="font-bold text-green-800">'위험 선호' 진입</span>
                        <p class="text-sm text-gray-500">자산의 75%를 TQQQ에 투자</p>
                    </div>
                    <div class="flow-box flow-action h-full">
                        <span class="font-bold">포지션 유지</span>
                        <p class="text-sm text-gray-500">리밸런싱 점검으로 이동</p>
                    </div>
                    <div class="flow-box flow-action h-full bg-red-50 border-red-500">
                        <span class="font-bold text-red-800">'위험 회피' 이탈</span>
                        <p class="text-sm text-gray-500">모든 TQQQ를 매도하여 100% 현금화</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="rebalancing" class="mb-16 bg-white rounded-lg shadow-md p-6 md:p-8">
            <h2 class="text-3xl font-bold text-center text-[#004AAD] mb-4">리밸런싱 하위 시스템</h2>
            <p class="text-center text-gray-600 max-w-3xl mx-auto mb-10">
                '위험 선호' 상태에서 포지션을 유지할 때, 이 하위 시스템이 활성화됩니다. TQQQ의 가격 변동으로 인해 초기 목표 비중(75%)에서 벗어나는 '포트폴리오 드리프트' 현상을 방지하고, 위험 수준을 일정하게 관리하는 것이 목적입니다.
            </p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                <div>
                    <h3 class="text-xl font-bold text-center text-[#0065D2] mb-4">리밸런싱 트리거 유형</h3>
                    <div class="space-y-4">
                        <div class="p-4 rounded-lg border-2 border-slate-200">
                            <h4 class="font-bold">🕒 시간 기준 (Time-based)</h4>
                            <p class="text-sm text-gray-600">자산 비중과 상관없이, 정해진 시점(월말, 분기말, 연말)에 도달하면 무조건 목표 비중으로 재조정합니다.</p>
                        </div>
                        <div class="p-4 rounded-lg border-2 border-slate-200">
                            <h4 class="font-bold">📊 절대적 허용 범위 (Absolute Band)</h4>
                            <p class="text-sm text-gray-600">TQQQ 비중이 목표치(75%)에서 고정된 값(예: ±5%)을 벗어나면 재조정합니다. (예: 70% 미만 또는 80% 초과)</p>
                        </div>
                        <div class="p-4 rounded-lg border-2 border-slate-200">
                            <h4 class="font-bold">➗ 상대적 허용 범위 (Relative Band)</h4>
                            <p class="text-sm text-gray-600">TQQQ 비중이 목표치(75%)에서 비례 값(예: ±10%)을 벗어나면 재조정합니다. (예: 67.5% 미만 또는 82.5% 초과)</p>
                        </div>
                    </div>
                </div>
                <div>
                    <h3 class="text-xl font-bold text-center text-[#0065D2] mb-4">목표 자산 배분</h3>
                    <div class="chart-container">
                        <canvas id="allocationDonutChart"></canvas>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="comparison" class="mb-16">
            <h2 class="text-3xl font-bold text-center text-[#004AAD] mb-8">허용 범위 방식 비교 분석</h2>
            <p class="text-center text-gray-600 max-w-3xl mx-auto mb-10">
                동일한 파라미터 값(10%)을 사용하더라도, '절대적' 방식과 '상대적' 방식은 리밸런싱이 실행되는 허용 범위에 차이를 만듭니다. 상대적 방식이 더 좁은 범위를 가져 더 잦은 거래를 유발할 수 있습니다.
            </p>
            <div class="bg-white rounded-lg shadow-md p-6 md:p-8">
                <div class="chart-container h-96 md:h-[450px]">
                    <canvas id="bandComparisonChart"></canvas>
                </div>
            </div>
        </section>

    </div>

    <footer class="text-center p-6 bg-[#004AAD] text-white">
        <p>이 인포그래픽은 제공된 Python 코드의 논리적 흐름을 시각적으로 설명하기 위해 제작되었습니다.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const brilliantBlues = ['#0065D2', '#87CEFA', '#369EFF', '#004AAD'];

            const tooltipTitleCallback = (tooltipItems) => {
                const item = tooltipItems[0];
                let label = item.chart.data.labels[item.dataIndex];
                if (Array.isArray(label)) {
                    return label.join(' ');
                }
                return label;
            };

            const wrapLabel = (label, maxWidth) => {
                if (label.length <= maxWidth) {
                    return label;
                }
                const words = label.split(' ');
                const lines = [];
                let currentLine = '';
                words.forEach(word => {
                    if ((currentLine + word).length > maxWidth) {
                        lines.push(currentLine.trim());
                        currentLine = '';
                    }
                    currentLine += word + ' ';
                });
                lines.push(currentLine.trim());
                return lines;
            };

            if (document.getElementById('allocationDonutChart')) {
                new Chart(document.getElementById('allocationDonutChart'), {
                    type: 'doughnut',
                    data: {
                        labels: ['TQQQ (투자 자산)', '현금 (안전 자산)'],
                        datasets: [{
                            label: '자산 배분',
                            data: [75, 25],
                            backgroundColor: [brilliantBlues[0], brilliantBlues[1]],
                            borderColor: '#ffffff',
                            borderWidth: 4,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                                labels: {
                                    font: { size: 14 }
                                }
                            },
                            title: {
                                display: true,
                                text: "'위험 선호' 상태의 목표 포트폴리오",
                                font: { size: 16 }
                            },
                            tooltip: {
                                callbacks: {
                                    title: tooltipTitleCallback
                                }
                            }
                        },
                        cutout: '60%',
                    }
                });
            }

            if (document.getElementById('bandComparisonChart')) {
                const targetWeight = 0.75;
                const param = 0.10;

                const absoluteLower = targetWeight - param;
                const absoluteUpper = targetWeight + param;

                const relativeLower = targetWeight * (1 - param);
                const relativeUpper = targetWeight * (1 + param);
                
                new Chart(document.getElementById('bandComparisonChart'), {
                    type: 'bar',
                    data: {
                        labels: ['절대적 허용 범위 (Absolute)', '상대적 허용 범위 (Relative)'],
                        datasets: [{
                            label: '하단 경계',
                            data: [absoluteLower * 100, relativeLower * 100],
                            backgroundColor: brilliantBlues[1],
                            borderColor: brilliantBlues[0],
                            borderWidth: 2,
                            barPercentage: 0.6,
                        }, {
                            label: '상단 경계',
                            data: [absoluteUpper * 100, relativeUpper * 100],
                            backgroundColor: brilliantBlues[0],
                            borderColor: brilliantBlues[3],
                            borderWidth: 2,
                            barPercentage: 0.6,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        indexAxis: 'y',
                        scales: {
                            x: {
                                beginAtZero: false,
                                title: {
                                    display: true,
                                    text: 'TQQQ 비중 (%)',
                                    font: { size: 14 }
                                },
                                ticks: {
                                    callback: function(value) {
                                        return value + '%'
                                    }
                                }
                            },
                            y: {
                                ticks: {
                                    font: { size: 14 }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                            title: {
                                display: true,
                                text: '리밸런싱 트리거 범위 비교 (파라미터 = 10%)',
                                font: { size: 16 }
                            },
                            tooltip: {
                                callbacks: {
                                    title: tooltipTitleCallback,
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed.x !== null) {
                                            label += context.parsed.x.toFixed(2) + '%';
                                        }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>
