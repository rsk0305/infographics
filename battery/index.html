<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¸í„°ë™í‹°ë¸Œ ë°°í„°ë¦¬ íŒ© ì—´ ì‹œë®¬ë ˆì´í„°</title>
    <style>
        body {
            font-family: 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif;
            background-color: #f4f7f6;
            color: #333;
            line-height: 1.6;
            display: flex;
            justify-content: center;
        }
        .container {
            max-width: 900px;
            margin: 20px;
            padding: 25px;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px_8px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #0b3d91;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
            text-align: center;
        }
        .simulator {
            background-color: #e3f2fd;
            border: 1px solid #bbdefb;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .input-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .input-group {
            display: flex;
            flex-direction: column;
        }
        label {
            font-weight: bold;
            color: #1e88e5;
            margin-bottom: 5px;
        }
        input[type="number"] {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1em;
        }
        button {
            grid-column: 1 / -1;
            background-color: #4caf50;
            color: white;
            padding: 15px;
            border: none;
            border-radius: 5px;
            font-size: 1.2em;
            cursor: pointer;
            margin-top: 20px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #45a049;
        }
        .results-box {
            background-color: #fffde7;
            border-left: 5px solid #fbc02d;
            padding: 20px;
            margin-top: 30px;
            border-radius: 5px;
            display: none; /* Initially hidden */
        }
        .results-box h3 {
            margin-top: 0;
            color: #c0392b;
        }
         .results-box p {
            margin: 10px 0;
            font-size: 1.1em;
        }
        .insight {
            background-color: #e8f5e9;
            border-left: 5px solid #4caf50;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
            font-style: italic;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸ”‹ ì¸í„°ë™í‹°ë¸Œ ë°°í„°ë¦¬ íŒ© ì—´ ì‹œë®¬ë ˆì´í„°</h1>
        <p>ì´ í˜ì´ì§€ëŠ” ë°°í„°ë¦¬ íŒ©ì˜ ì—´ì  ê±°ë™ì„ ì‹œë®¬ë ˆì´ì…˜í•©ë‹ˆë‹¤. ì•„ë˜ ì…ë ¥ê°’ì„ ì¡°ì •í•œ í›„ 'ê³„ì‚° ì‹œì‘' ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‹¤ì–‘í•œ ì‹œë‚˜ë¦¬ì˜¤ì˜ ê²°ê³¼ë¥¼ ì¦‰ì‹œ í™•ì¸í•´ë³´ì„¸ìš”.</p>
        
        <div class="simulator">
            <h2>âš™ï¸ STEP 1: ë³€ìˆ˜ ì…ë ¥</h2>
            <div class="input-grid">
                <div class="input-group">
                    <label for="cell_count">ì…€ ê°œìˆ˜ (ì§ìˆ˜)</label>
                    <input type="number" id="cell_count" value="8">
                </div>
                <div class="input-group">
                    <label for="discharge_current_a">ì…€ ë‹¹ ë°©ì „ ì „ë¥˜ (A)</label>
                    <input type="number" id="discharge_current_a" value="40.0">
                </div>
                <div class="input-group">
                    <label for="ambient_temp_c">ì™¸ë¶€ ê³µê¸° ì˜¨ë„ (Â°C)</label>
                    <input type="number" id="ambient_temp_c" value="40.0">
                </div>
                <div class="input-group">
                    <label for="initial_temp_c">ë°°í„°ë¦¬ ì´ˆê¸° ì˜¨ë„ (Â°C)</label>
                    <input type="number" id="initial_temp_c" value="30.0">
                </div>
                <div class="input-group">
                    <label for="pcm_melt_temp_c">PCM ë…¹ëŠ”ì  (Â°C)</label>
                    <input type="number" id="pcm_melt_temp_c" value="50.0">
                </div>
                <div class="input-group">
                    <label for="limit_temp_c">ìµœì¢… ì œí•œ ì˜¨ë„ (Â°C)</label>
                    <input type="number" id="limit_temp_c" value="70.0">
                </div>
                <button onclick="calculateThermalPerformance()">ê³„ì‚° ì‹œì‘</button>
            </div>
        </div>

        <div id="results-output" class="results-box">
            </div>
    </div>

    <script>
        function calculateThermalPerformance() {
            // --- ë¬¼ë¦¬ì  ìƒìˆ˜ ì •ì˜ ---
            const CONSTANTS = {
                CELL_DIAMETER_M: 0.021,
                CELL_HEIGHT_M: 0.070,
                CELL_MASS_KG: 0.068,
                CELL_INTERNAL_RESISTANCE_OHM: 0.005,
                SPECIFIC_HEAT_CELL_J_KGK: 900,
                DENSITY_POTTING_KG_M3: 2500,
                SPECIFIC_HEAT_POTTING_J_KGK: 1200,
                LATENT_HEAT_POTTING_J_KG: 155000,
                CASE_THICKNESS_M: 0.002,
                DENSITY_ALUMINUM_KG_M3: 2700,
                SPECIFIC_HEAT_ALUMINUM_J_KGK: 900,
                HEAT_TRANSFER_COEFFICIENT_W_M2K: 10.0
            };

            // 1. HTMLì—ì„œ ì…ë ¥ê°’ ê°€ì ¸ì˜¤ê¸° (ìˆ«ìë¡œ ë³€í™˜)
            const cell_count = parseInt(document.getElementById('cell_count').value);
            const discharge_current_a = parseFloat(document.getElementById('discharge_current_a').value);
            const ambient_temp_c = parseFloat(document.getElementById('ambient_temp_c').value);
            const initial_temp_c = parseFloat(document.getElementById('initial_temp_c').value);
            const pcm_melt_temp_c = parseFloat(document.getElementById('pcm_melt_temp_c').value);
            const limit_temp_c = parseFloat(document.getElementById('limit_temp_c').value);

            if (cell_count % 2 !== 0) {
                alert("ì…€ ê°œìˆ˜ëŠ” ì§ìˆ˜ì—¬ì•¼ í•©ë‹ˆë‹¤.");
                return;
            }

            // 2. ì§€ì˜¤ë©”íŠ¸ë¦¬ ë° ì§ˆëŸ‰ ê³„ì‚°
            const rows = 2;
            const cols = cell_count / 2;
            const pack_width_m = cols * CONSTANTS.CELL_DIAMETER_M;
            const pack_depth_m = rows * CONSTANTS.CELL_DIAMETER_M;
            const pack_height_m = CONSTANTS.CELL_HEIGHT_M;
            
            const volume_total_m3 = pack_width_m * pack_depth_m * pack_height_m;
            const volume_cell_one_m3 = Math.PI * Math.pow(CONSTANTS.CELL_DIAMETER_M / 2, 2) * CONSTANTS.CELL_HEIGHT_M;
            const volume_cells_total_m3 = volume_cell_one_m3 * cell_count;
            const volume_potting_m3 = volume_total_m3 - volume_cells_total_m3;

            const mass_cells_kg = CONSTANTS.CELL_MASS_KG * cell_count;
            const mass_potting_kg = volume_potting_m3 * CONSTANTS.DENSITY_POTTING_KG_M3;
            const case_surface_area_m2 = 2 * (pack_width_m * pack_depth_m + pack_width_m * pack_height_m + pack_depth_m * pack_height_m);
            const volume_case_m3 = case_surface_area_m2 * CONSTANTS.CASE_THICKNESS_M;
            const mass_case_kg = volume_case_m3 * CONSTANTS.DENSITY_ALUMINUM_KG_M3;

            // 3. ì´ ë°œì—´ëŸ‰ ë° ì—´ìš©ëŸ‰ ê³„ì‚°
            const heat_generation_per_cell_w = Math.pow(discharge_current_a, 2) * CONSTANTS.CELL_INTERNAL_RESISTANCE_OHM;
            const heat_generation_total_w = heat_generation_per_cell_w * cell_count;
            
            const heat_capacity_cells_j_k = mass_cells_kg * CONSTANTS.SPECIFIC_HEAT_CELL_J_KGK;
            const heat_capacity_potting_j_k = mass_potting_kg * CONSTANTS.SPECIFIC_HEAT_POTTING_J_KGK;
            const heat_capacity_case_j_k = mass_case_kg * CONSTANTS.SPECIFIC_HEAT_ALUMINUM_J_KGK;
            const total_heat_capacity_j_k = heat_capacity_cells_j_k + heat_capacity_potting_j_k + heat_capacity_case_j_k;

            // 4. 3ë‹¨ê³„ ì‹œê°„ ê³„ì‚°
            let t1 = 0, t2 = 0, t3 = 0;

            // Phase 1: ì´ˆê¸° ì˜¨ë„ -> PCM ë…¹ëŠ”ì 
            if (pcm_melt_temp_c > initial_temp_c) {
                const delta_t1 = pcm_melt_temp_c - initial_temp_c;
                const energy_q1 = total_heat_capacity_j_k * delta_t1;
                const avg_temp_t1 = (initial_temp_c + pcm_melt_temp_c) / 2;
                const p_out1 = CONSTANTS.HEAT_TRANSFER_COEFFICIENT_W_M2K * case_surface_area_m2 * (avg_temp_t1 - ambient_temp_c);
                const p_net1 = heat_generation_total_w - Math.max(0, p_out1);
                if (p_net1 > 0) t1 = energy_q1 / p_net1;
                else t1 = Infinity;
            }

            // Phase 2: PCM ìƒë³€í™” ì™„ë£Œ
            const energy_q2 = mass_potting_kg * CONSTANTS.LATENT_HEAT_POTTING_J_KG;
            const p_out2 = CONSTANTS.HEAT_TRANSFER_COEFFICIENT_W_M2K * case_surface_area_m2 * (pcm_melt_temp_c - ambient_temp_c);
            const p_net2 = heat_generation_total_w - Math.max(0, p_out2);
            if (p_net2 > 0) t2 = energy_q2 / p_net2;
            else t2 = Infinity;

            // Phase 3: PCM ë…¹ëŠ”ì  -> ìµœì¢… í•œê³„ ì˜¨ë„
            if (limit_temp_c > pcm_melt_temp_c) {
                const delta_t3 = limit_temp_c - pcm_melt_temp_c;
                const energy_q3 = total_heat_capacity_j_k * delta_t3;
                const avg_temp_t3 = (pcm_melt_temp_c + limit_temp_c) / 2;
                const p_out3 = CONSTANTS.HEAT_TRANSFER_COEFFICIENT_W_M2K * case_surface_area_m2 * (avg_temp_t3 - ambient_temp_c);
                const p_net3 = heat_generation_total_w - Math.max(0, p_out3);
                if (p_net3 > 0) t3 = energy_q3 / p_net3;
                else t3 = Infinity;
            }
            
            // 5. ê²°ê³¼ í‘œì‹œ
            const resultsDiv = document.getElementById('results-output');
            const formatTime = (seconds) => {
                if (seconds === Infinity) return "ë¬´í•œëŒ€ (ì˜¨ë„ê°€ ë” ì´ìƒ ì˜¤ë¥´ì§€ ì•ŠìŒ)";
                return `${seconds.toFixed(1)}ì´ˆ (${(seconds / 60).toFixed(1)}ë¶„)`;
            };
            
            const total_safe_time = t1 === Infinity ? Infinity : t1 + t2;
            const total_limit_time = total_safe_time === Infinity ? Infinity : total_safe_time + t3;

            let insight_text = "";
            const final_dissipation = CONSTANTS.HEAT_TRANSFER_COEFFICIENT_W_M2K * case_surface_area_m2 * (limit_temp_c - ambient_temp_c);
            if (heat_generation_total_w < final_dissipation) {
                insight_text = "ë°œì—´ëŸ‰ë³´ë‹¤ ìì—° ë°©ì—´ëŸ‰ì´ ë” ë§ê±°ë‚˜ ë¹„ìŠ·í•˜ì—¬ ì˜¨ë„ê°€ ì•ˆì •ì ìœ¼ë¡œ ìœ ì§€ë  ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤. ì¥ê¸°ì ì¸ ì•ˆì •ì„±ì€ ì—´í‰í˜• ì˜¨ë„ë¥¼ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤.";
            } else {
                insight_text = "ì´ ë°œì—´ëŸ‰ì´ ìì—° ë°©ì—´ëŸ‰ë³´ë‹¤ í›¨ì”¬ ë§ìŠµë‹ˆë‹¤. ë³„ë„ì˜ ëŠ¥ë™ ëƒ‰ê° ì‹œìŠ¤í…œ(íŒ¬, ì•¡ì²´ ëƒ‰ê° ë“±)ì´ ì—†ë‹¤ë©´ ë°°í„°ë¦¬ íŒ©ì˜ ì˜¨ë„ëŠ” ì§€ì†ì ìœ¼ë¡œ ìƒìŠ¹í•˜ì—¬ ìœ„í—˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
            }

            resultsDiv.innerHTML = `
                <h3>ğŸ“Š ê³„ì‚° ê²°ê³¼:</h3>
                <p><strong>[Phase 1]</strong> PCM ë…¹ëŠ”ì (${pcm_melt_temp_c}Â°C) ë„ë‹¬ ì‹œê°„: <b>${formatTime(t1)}</b></p>
                <p><strong>[Phase 2]</strong> PCM ì—´ í¡ìˆ˜(ë²„í¼) ì‹œê°„: <b>${formatTime(t2)}</b></p>
                <p><strong>[Phase 3]</strong> ìµœì¢… í•œê³„(${limit_temp_c}Â°C) ë„ë‹¬ ì¶”ê°€ ì‹œê°„: <b>${formatTime(t3)}</b></p>
                <hr>
                <p class="results-summary">âœ… ì´ ì•ˆì „ ì‹œê°„ (PCM ì†Œì§„ê¹Œì§€): <b>${formatTime(total_safe_time)}</b></p>
                <p class="results-summary">âš ï¸ ìœ„í—˜ ë„ë‹¬ ì‹œê°„ (ìµœì¢… í•œê³„ê¹Œì§€): <b>${formatTime(total_limit_time)}</b></p>
                <div class="insight">
                    <strong>ğŸ’¡ ì—”ì§€ë‹ˆì–´ë§ ì¸ì‚¬ì´íŠ¸:</strong> 
                    <p>${insight_text}</p>
                </div>
            `;
            resultsDiv.style.display = 'block';
        }
    </script>
</body>
</html>
