<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>인터랙티브 배터리 팩 열 시뮬레이터</title>
    <style>
        body {
            font-family: 'Malgun Gothic', '맑은 고딕', sans-serif;
            background-color: #f4f7f6;
            color: #333;
            line-height: 1.6;
            display: flex;
            justify-content: center;
        }
        .container {
            max-width: 900px;
            margin: 20px;
            padding: 25px;
            background-color: #ffffff;
            border-radius: 10px;
            box-shadow: 0 4px_8px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #0b3d91;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
            text-align: center;
        }
        .simulator {
            background-color: #e3f2fd;
            border: 1px solid #bbdefb;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .input-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .input-group {
            display: flex;
            flex-direction: column;
        }
        label {
            font-weight: bold;
            color: #1e88e5;
            margin-bottom: 5px;
        }
        input[type="number"] {
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 1em;
        }
        button {
            grid-column: 1 / -1;
            background-color: #4caf50;
            color: white;
            padding: 15px;
            border: none;
            border-radius: 5px;
            font-size: 1.2em;
            cursor: pointer;
            margin-top: 20px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #45a049;
        }
        .results-box {
            background-color: #fffde7;
            border-left: 5px solid #fbc02d;
            padding: 20px;
            margin-top: 30px;
            border-radius: 5px;
            display: none; /* Initially hidden */
        }
        .results-box h3 {
            margin-top: 0;
            color: #c0392b;
        }
         .results-box p {
            margin: 10px 0;
            font-size: 1.1em;
        }
        .insight {
            background-color: #e8f5e9;
            border-left: 5px solid #4caf50;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
            font-style: italic;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>🔋 인터랙티브 배터리 팩 열 시뮬레이터</h1>
        <p>이 페이지는 배터리 팩의 열적 거동을 시뮬레이션합니다. 아래 입력값을 조정한 후 '계산 시작' 버튼을 눌러 다양한 시나리오의 결과를 즉시 확인해보세요.</p>
        
        <div class="simulator">
            <h2>⚙️ STEP 1: 변수 입력</h2>
            <div class="input-grid">
                <div class="input-group">
                    <label for="cell_count">셀 개수 (짝수)</label>
                    <input type="number" id="cell_count" value="8">
                </div>
                <div class="input-group">
                    <label for="discharge_current_a">셀 당 방전 전류 (A)</label>
                    <input type="number" id="discharge_current_a" value="40.0">
                </div>
                <div class="input-group">
                    <label for="ambient_temp_c">외부 공기 온도 (°C)</label>
                    <input type="number" id="ambient_temp_c" value="40.0">
                </div>
                <div class="input-group">
                    <label for="initial_temp_c">배터리 초기 온도 (°C)</label>
                    <input type="number" id="initial_temp_c" value="30.0">
                </div>
                <div class="input-group">
                    <label for="pcm_melt_temp_c">PCM 녹는점 (°C)</label>
                    <input type="number" id="pcm_melt_temp_c" value="50.0">
                </div>
                <div class="input-group">
                    <label for="limit_temp_c">최종 제한 온도 (°C)</label>
                    <input type="number" id="limit_temp_c" value="70.0">
                </div>
                <button onclick="calculateThermalPerformance()">계산 시작</button>
            </div>
        </div>

        <div id="results-output" class="results-box">
            </div>
    </div>

    <script>
        function calculateThermalPerformance() {
            // --- 물리적 상수 정의 ---
            const CONSTANTS = {
                CELL_DIAMETER_M: 0.021,
                CELL_HEIGHT_M: 0.070,
                CELL_MASS_KG: 0.068,
                CELL_INTERNAL_RESISTANCE_OHM: 0.005,
                SPECIFIC_HEAT_CELL_J_KGK: 900,
                DENSITY_POTTING_KG_M3: 2500,
                SPECIFIC_HEAT_POTTING_J_KGK: 1200,
                LATENT_HEAT_POTTING_J_KG: 155000,
                CASE_THICKNESS_M: 0.002,
                DENSITY_ALUMINUM_KG_M3: 2700,
                SPECIFIC_HEAT_ALUMINUM_J_KGK: 900,
                HEAT_TRANSFER_COEFFICIENT_W_M2K: 10.0
            };

            // 1. HTML에서 입력값 가져오기 (숫자로 변환)
            const cell_count = parseInt(document.getElementById('cell_count').value);
            const discharge_current_a = parseFloat(document.getElementById('discharge_current_a').value);
            const ambient_temp_c = parseFloat(document.getElementById('ambient_temp_c').value);
            const initial_temp_c = parseFloat(document.getElementById('initial_temp_c').value);
            const pcm_melt_temp_c = parseFloat(document.getElementById('pcm_melt_temp_c').value);
            const limit_temp_c = parseFloat(document.getElementById('limit_temp_c').value);

            if (cell_count % 2 !== 0) {
                alert("셀 개수는 짝수여야 합니다.");
                return;
            }

            // 2. 지오메트리 및 질량 계산
            const rows = 2;
            const cols = cell_count / 2;
            const pack_width_m = cols * CONSTANTS.CELL_DIAMETER_M;
            const pack_depth_m = rows * CONSTANTS.CELL_DIAMETER_M;
            const pack_height_m = CONSTANTS.CELL_HEIGHT_M;
            
            const volume_total_m3 = pack_width_m * pack_depth_m * pack_height_m;
            const volume_cell_one_m3 = Math.PI * Math.pow(CONSTANTS.CELL_DIAMETER_M / 2, 2) * CONSTANTS.CELL_HEIGHT_M;
            const volume_cells_total_m3 = volume_cell_one_m3 * cell_count;
            const volume_potting_m3 = volume_total_m3 - volume_cells_total_m3;

            const mass_cells_kg = CONSTANTS.CELL_MASS_KG * cell_count;
            const mass_potting_kg = volume_potting_m3 * CONSTANTS.DENSITY_POTTING_KG_M3;
            const case_surface_area_m2 = 2 * (pack_width_m * pack_depth_m + pack_width_m * pack_height_m + pack_depth_m * pack_height_m);
            const volume_case_m3 = case_surface_area_m2 * CONSTANTS.CASE_THICKNESS_M;
            const mass_case_kg = volume_case_m3 * CONSTANTS.DENSITY_ALUMINUM_KG_M3;

            // 3. 총 발열량 및 열용량 계산
            const heat_generation_per_cell_w = Math.pow(discharge_current_a, 2) * CONSTANTS.CELL_INTERNAL_RESISTANCE_OHM;
            const heat_generation_total_w = heat_generation_per_cell_w * cell_count;
            
            const heat_capacity_cells_j_k = mass_cells_kg * CONSTANTS.SPECIFIC_HEAT_CELL_J_KGK;
            const heat_capacity_potting_j_k = mass_potting_kg * CONSTANTS.SPECIFIC_HEAT_POTTING_J_KGK;
            const heat_capacity_case_j_k = mass_case_kg * CONSTANTS.SPECIFIC_HEAT_ALUMINUM_J_KGK;
            const total_heat_capacity_j_k = heat_capacity_cells_j_k + heat_capacity_potting_j_k + heat_capacity_case_j_k;

            // 4. 3단계 시간 계산
            let t1 = 0, t2 = 0, t3 = 0;

            // Phase 1: 초기 온도 -> PCM 녹는점
            if (pcm_melt_temp_c > initial_temp_c) {
                const delta_t1 = pcm_melt_temp_c - initial_temp_c;
                const energy_q1 = total_heat_capacity_j_k * delta_t1;
                const avg_temp_t1 = (initial_temp_c + pcm_melt_temp_c) / 2;
                const p_out1 = CONSTANTS.HEAT_TRANSFER_COEFFICIENT_W_M2K * case_surface_area_m2 * (avg_temp_t1 - ambient_temp_c);
                const p_net1 = heat_generation_total_w - Math.max(0, p_out1);
                if (p_net1 > 0) t1 = energy_q1 / p_net1;
                else t1 = Infinity;
            }

            // Phase 2: PCM 상변화 완료
            const energy_q2 = mass_potting_kg * CONSTANTS.LATENT_HEAT_POTTING_J_KG;
            const p_out2 = CONSTANTS.HEAT_TRANSFER_COEFFICIENT_W_M2K * case_surface_area_m2 * (pcm_melt_temp_c - ambient_temp_c);
            const p_net2 = heat_generation_total_w - Math.max(0, p_out2);
            if (p_net2 > 0) t2 = energy_q2 / p_net2;
            else t2 = Infinity;

            // Phase 3: PCM 녹는점 -> 최종 한계 온도
            if (limit_temp_c > pcm_melt_temp_c) {
                const delta_t3 = limit_temp_c - pcm_melt_temp_c;
                const energy_q3 = total_heat_capacity_j_k * delta_t3;
                const avg_temp_t3 = (pcm_melt_temp_c + limit_temp_c) / 2;
                const p_out3 = CONSTANTS.HEAT_TRANSFER_COEFFICIENT_W_M2K * case_surface_area_m2 * (avg_temp_t3 - ambient_temp_c);
                const p_net3 = heat_generation_total_w - Math.max(0, p_out3);
                if (p_net3 > 0) t3 = energy_q3 / p_net3;
                else t3 = Infinity;
            }
            
            // 5. 결과 표시
            const resultsDiv = document.getElementById('results-output');
            const formatTime = (seconds) => {
                if (seconds === Infinity) return "무한대 (온도가 더 이상 오르지 않음)";
                return `${seconds.toFixed(1)}초 (${(seconds / 60).toFixed(1)}분)`;
            };
            
            const total_safe_time = t1 === Infinity ? Infinity : t1 + t2;
            const total_limit_time = total_safe_time === Infinity ? Infinity : total_safe_time + t3;

            let insight_text = "";
            const final_dissipation = CONSTANTS.HEAT_TRANSFER_COEFFICIENT_W_M2K * case_surface_area_m2 * (limit_temp_c - ambient_temp_c);
            if (heat_generation_total_w < final_dissipation) {
                insight_text = "발열량보다 자연 방열량이 더 많거나 비슷하여 온도가 안정적으로 유지될 가능성이 있습니다. 장기적인 안정성은 열평형 온도를 확인해야 합니다.";
            } else {
                insight_text = "총 발열량이 자연 방열량보다 훨씬 많습니다. 별도의 능동 냉각 시스템(팬, 액체 냉각 등)이 없다면 배터리 팩의 온도는 지속적으로 상승하여 위험할 수 있습니다.";
            }

            resultsDiv.innerHTML = `
                <h3>📊 계산 결과:</h3>
                <p><strong>[Phase 1]</strong> PCM 녹는점(${pcm_melt_temp_c}°C) 도달 시간: <b>${formatTime(t1)}</b></p>
                <p><strong>[Phase 2]</strong> PCM 열 흡수(버퍼) 시간: <b>${formatTime(t2)}</b></p>
                <p><strong>[Phase 3]</strong> 최종 한계(${limit_temp_c}°C) 도달 추가 시간: <b>${formatTime(t3)}</b></p>
                <hr>
                <p class="results-summary">✅ 총 안전 시간 (PCM 소진까지): <b>${formatTime(total_safe_time)}</b></p>
                <p class="results-summary">⚠️ 위험 도달 시간 (최종 한계까지): <b>${formatTime(total_limit_time)}</b></p>
                <div class="insight">
                    <strong>💡 엔지니어링 인사이트:</strong> 
                    <p>${insight_text}</p>
                </div>
            `;
            resultsDiv.style.display = 'block';
        }
    </script>
</body>
</html>
